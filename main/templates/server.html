{% extends 'base.html' %}
{% load static %}

    {% block head_style %}
    <style>
        .card-title{
            cursor: pointer;
            text-decoration: underline;
        }
        .fa-info{
            cursor: pointer;
        }
        
        .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgb(0,0,0); background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
        .close:hover, .close:focus { color: black; text-decoration: none; cursor: pointer; }
    </style>
    {% endblock %}
    
    {% block page_content %}
                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Page Heading -->
                     <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">Types of Servers</h1>
                        <a href="addserver.html" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i class="fa-solid fa-plus"></i> Add Server</a>
                    </div>
                    <div class="row">
                        {% for server in servers %}
                        <!-- Server 1 Card -->
                        <div class="col-md-3" style="padding-top:1em;">
                            <div class="card server-card shadow">
                                <div class="card-body text-center d-flex flex-column align-items-center" style="font-size: 0.6em;">
                                    <i class="fas fa-server server-icon"></i>
                                    <a href="/vms?server={{server.id}}" style="color:#858796;"><h5 class="card-title mt-3">{{server.name}}</h5></a>
                                    <p class="card-text server-ip"><strong>IP Address:</strong> {{server.ip_address}}</p>
                                    <p class="card-text server-status"><strong>Status:</strong> <span class="text-success"><i class="fas fa-check-circle status-icon"></i> UP</span></p>
                                    <p class="card-text server-cpu"><strong>CPU Usage:</strong> {{server.cpu_utilisation}}</p>
                                    <p class="card-text server-memory"><strong>Memory Usage:</strong> {{server.storage}}</p>
                                    <div class="d-flex align-items-center justify-content-around col-4">
                                        <i class="fa-solid fa-info info-icon" style="cursor: pointer;"></i>
                                        <i class="fa-regular fa-pen-to-square"></i>
                                        <i class="fa-regular fa-trash-can"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                   
                </div>
    {% endblock %}

    {% block java_scripts %}
    <script>
        $(".card-title").on('click', function(){
            window.location.href = "vms.html"
        })
        $(".fa-plus").on('click', function(){
            window.location.href = "addserver.html"
        })


        // Get elements
        const infoIcons = document.querySelectorAll('.info-icon');
    const modal = document.getElementById('info-modal');
    const closeModal = document.getElementById('close-modal');

    // Show modal on info icon click
    infoIcons.forEach(icon => {
        icon.onclick = function() {
            // Find the closest card to get its data
            const cardBody = this.closest('.card-body');

            // Get server data using class names
            const ipAddress = cardBody.querySelector('.server-ip').textContent.split(': ')[1];
            const status = cardBody.querySelector('.server-status').textContent.split(': ')[1];
            const cpuUsage = cardBody.querySelector('.server-cpu').textContent.split(': ')[1];
            const memoryUsage = cardBody.querySelector('.server-memory').textContent.split(': ')[1];

            // Populate modal with the data
            document.getElementById('modal-ip').textContent = ipAddress;
            document.getElementById('modal-status').textContent = status;
            document.getElementById('modal-cpu').textContent = cpuUsage;
            document.getElementById('modal-memory').textContent = memoryUsage;

            // Display the modal
            modal.style.display = "block";
        };
    });

    // Close modal
    closeModal.onclick = function() {
        modal.style.display = "none";
    };

    // Close modal when clicking outside of it
    window.onclick = function(event) {
        if (event.target === modal) {
            modal.style.display = "none";
        }
    };
    </script>
{% endblock %}